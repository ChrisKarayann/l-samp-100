<!-- app.html - ZONELESS MIGRATION: All signals now use () call syntax -->

<div class="sampler-shell" [class.silent-mode]="!isKeyboardCaptured()">

  <header>
    <div class="brand-unit">
      <h1>L-SAMP <span class="model-number">100</span></h1>
      <div class="unit-subtitle">Broadcast Audio Controller</div>
    </div>



    <div class="header-controls">
      <div class="master-bpm-rail" (wheel)="handleWheel($event, 'bpm', 'MASTER')"
        title="Global Master Clock (Scroll to adjust)">
        <div class="clock-mode-selector">
          <button [class.active]="clockMode() === 'manual'" (click)="setClockMode('manual')"
            title="Manual Mode">M</button>
          <button [class.active]="clockMode() === 'auto'" (click)="setClockMode('auto')"
            title="Auto Mode (Average BPM)">A</button>
        </div>
        <div class="bpm-lcd">
          <div class="bpm-label-stack">
            <span>{{ clockMode() === 'auto' ? 'AUTO' : 'MASTER' }}</span>
            <span>CLOCK</span>
          </div>
          <div class="digits">
            <span class="value">{{ masterBpm().toFixed(1).split('.')[0] }}</span><span class="decimal">.{{
              masterBpm().toFixed(1).split('.')[1] }}</span>
          </div>
          <span class="unit">BPM</span>
        </div>
      </div>

      <div class="menu-dropdown-wrapper">
        <button (click)="toggleMenuOpen()" class="menu-btn" title="Application Menu">
          <svg viewBox="0 0 24 24" fill="none" [attr.stroke]="accentColor()" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
            </path>
          </svg>
        </button>
        <div class="menu-dropdown" *ngIf="showMenuDropdown()">
          <div class="menu-item" (click)="openModal('instructions')">Instructions</div>
          <div class="menu-item" (click)="openModal('settings')">Settings</div>
          <div class="menu-item" (click)="openModal('info')">Info</div>
          <div class="menu-item-divider"></div>
          <div class="menu-item" (click)="openModal('clear-selected')">Clear Selected Pad</div>
          <div class="menu-item" (click)="openModal('clear-all')">Clear All Pads</div>
          <div class="menu-item-divider"></div>
          <div class="menu-item" (click)="openModal('factory-reset')">System Reset (Clear Cache)</div>
          <div class="menu-item-divider"></div>
          <div class="menu-item" (click)="reloadUI()">Reload UI</div>
          <div class="menu-item" (click)="toggleDevTools()">Toggle DevTools (Dedicated)</div>
        </div>
      </div>

      <button (click)="openHarbor()" class="icon-btn" title="Open Audio List">
        <svg class="list-icon" viewBox="0 0 24 24" fill="none" [attr.stroke]="accentColor()" stroke-width="2">
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <circle cx="3" cy="6" r="1" [attr.fill]="accentColor()"></circle>
          <circle cx="3" cy="12" r="1" [attr.fill]="accentColor()"></circle>
          <circle cx="3" cy="18" r="1" [attr.fill]="accentColor()"></circle>
        </svg>
        Audio List
      </button>

      <button (click)="toggleKeyboard()" [class.active-mode]="isKeyboardCaptured()"
        title="Toggle hardware keyboard capture">
        {{ isKeyboardCaptured() ? 'Release Keyboard' : 'Capture Keyboard' }}
      </button>

      <div class="global-status" [class.alive]="isKeyboardCaptured()">
        {{ isKeyboardCaptured() ? 'Consonance Mode' : 'Silent Mode' }}
      </div>
    </div>
  </header>

  <main class="sampler-container">

    <section class="grid">
      <div *ngFor="let p of pads()" class="pad-cell" [class.active]="activeKey() === p"
        [class.playing]="playingPads().has(p)" [style.transition-duration]="getTransitionDuration(p)"
        [class.selected]="selectedPad() === p" [class.restricted]="isCommunityBuild() && !['Q', 'W', 'E', 'R'].includes(p)"
        (click)="selectPad(p)" [title]="(isCommunityBuild() && !['Q', 'W', 'E', 'R'].includes(p)) ? 'Pad available in L-SAMP 100 Pro' : 'Select Pad [ ' + p + ' ]'">

        <div class="pad-header">
          <input type="text" [ngModel]="padNames()[p]" (focus)="handleLabelFocus(p, $any($event))"
            (blur)="handleLabelBlur(p, $any($event))" (input)="updateCustomName(p, $any($event.target).value)"
            (keydown)="$event.stopPropagation()" (keyup)="$event.stopPropagation()" (click)="$event.stopPropagation()"
            placeholder="LABEL" class="pad-name-input" title="Edit label for Pad [ {{p}} ]">
        </div>

        <div class="pad-body">
          <div class="loop-indicator" *ngIf="isPadLooping(p)" [class.active-playing]="playingPads().has(p)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <polyline points="17 1 21 5 17 9"></polyline>
              <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
              <polyline points="7 23 3 19 7 15"></polyline>
              <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
            </svg>
          </div>

          <span class="key-label">{{p}}</span>

          <div class="time-remaining" *ngIf="isPadActive(p)">
            <span [id]="'timer-' + p" class="pad-timer">00:00.0</span>
          </div>

          <div class="status-dot" [class.loaded]="hasSound(p) || loadedPads().has(p)"></div>

          <div class="pad-controls" *ngIf="hasSound(p) || loadedPads().has(p)">
            <div class="pad-bpm-box" title="Detected Sample BPM">
              <div class="bpm-value-display" [class.synced]="padSync()[p]">
                <span class="int">{{ getBpmParts(p).integer }}</span>
                <span class="dot">.</span>
                <span class="dec">{{ getBpmParts(p).decimal }}</span>
              </div>
              <span class="label">BPM</span>
            </div>
            <div class="sync-icon" [class.active]="padSync()[p]"
              [title]="padSync()[p] ? 'Sync Active' : 'Sync Inactive'"
              (click)="toggleSync(p); $event.stopPropagation()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path
                  d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
              </svg>
            </div>
          </div>
        </div>

        <div class="pad-footer">
          <div class="fade-progress-bar" [class.active]="playingPads().has(p)"
            [style.transition-duration]="getTransitionDuration(p)"></div>
          <canvas [id]="'osc-' + p" class="mini-oscillator"></canvas>
        </div>
      </div>
    </section>

    <section class="control-panel" [class.empty-state]="!selectedPad()">

      <ng-container *ngIf="selectedPad(); else emptyPanel">
        <div class="panel-header">
          <h3>PAD [ {{ selectedPad() }} ]</h3>
          <span class="file-status" [class.active]="hasSound(selectedPad()!) || loadedPads().has(selectedPad()!)"
            [class.loading]="loadingProgress().has(selectedPad()!)">
            <ng-container *ngIf="loadingProgress().get(selectedPad()!) !== undefined; else staticStatus">
              LOAD {{ loadingProgress().get(selectedPad()!) }}%
            </ng-container>
            <ng-template #staticStatus>
              {{ (hasSound(selectedPad()!) || loadedPads().has(selectedPad()!)) ? '● LOADED' : '○ EMPTY' }}
            </ng-template>
          </span>
        </div>

        <div class="control-body" #controlBody>

          <div class="display-group">
            <div class="source-header">
              <label>Audio From List</label>

              <div class="inject-btn-compact" (click)="triggerExternalFileSelection(selectedPad()!)"
                title="Load external audio file from system">
                <span>Inject External</span>
              </div>
            </div>

            <div class="harbor-selector">
              <select #harborSelect [ngModel]="fileTruth()[selectedPad()!] || ''"
                (change)="loadFromHarbor(harborSelect.value, selectedPad()!)"
                title="Select audio file from Harbor library">

                <option value="" [selected]="!fileTruth()[selectedPad()!]">-- NO SIGNAL --</option>

                <!-- Dynamic Entry for External Files -->
                <option *ngIf="isExternalFile(fileTruth()[selectedPad()!])" [value]="fileTruth()[selectedPad()!]"
                  selected>
                  [ EXTERNAL ] {{ getDisplayName(fileTruth()[selectedPad()!]) }}
                </option>

                <optgroup *ngFor="let group of groupedFiles()" [label]="group[0]">
                  <option *ngFor="let file of group[1]" [value]="file">
                    {{ getDisplayName(file) }}
                  </option>
                </optgroup>
              </select>
              <button class="refresh-btn" (click)="refreshLibrary()" title="Refresh Harbor">↻</button>
            </div>
          </div>

          <div class="parameter-grid">
            <div class="param-box gain-box">
              <div class="row-header">
                <label>Gain ({{ (currentVol() * 100).toFixed(0) }}%)</label>
                <svg class="gain-pulse-icon" viewBox="0 0 40 12">
                  <path [attr.d]="gainPath()" fill="none" [attr.stroke]="accentColor()" stroke-width="2"
                    stroke-linecap="round" />
                </svg>
              </div>
              <input type="range" min="0" max="1.5" step="0.01" [ngModel]="currentVol()" (input)="updateVolume($event)"
                (wheel)="handleWheel($event, 'gain')" class="vol-slider" title="Adjust pad output gain">
            </div>

            <div class="param-box">
              <div class="fade-header">
                <label>Fade Envelope</label>
                <svg class="envelope-icon" viewBox="0 0 40 12">
                  <path [attr.d]="envelopePath()" fill="none" [attr.stroke]="accentColor()" stroke-width="2" />
                </svg>
              </div>
              <div class="fade-row">
                <div class="fade-group">
                  <label>Attack ({{ currentAttack().toFixed(2) }}s)</label>
                  <input type="range" min="0" max="4" step="0.01" [ngModel]="currentAttack()"
                    (input)="updateFade($event, 'attack')" (wheel)="handleWheel($event, 'attack')" class="glow-slider"
                    title="Adjust fade-in duration">
                </div>
                <div class="fade-group">
                  <label>Release ({{ currentRelease().toFixed(2) }}s)</label>
                  <input type="range" min="0" max="4" step="0.01" [ngModel]="currentRelease()"
                    (input)="updateFade($event, 'release')" (wheel)="handleWheel($event, 'release')" class="glow-slider"
                    title="Adjust fade-out duration">
                </div>
              </div>
            </div>

            <div class="param-box playback-box">
              <div class="row-header">
                <label>Playback</label>
                <button class="loop-toggle-btn-compact" [class.active]="isPadLooping(selectedPad()!)"
                  (click)="togglePadLoop(selectedPad()!)" title="Toggle loop/one-shot mode">

                  <svg *ngIf="isPadLooping(selectedPad()!)" class="rolling-icon" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="17 1 21 5 17 9"></polyline>
                    <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                    <polyline points="7 23 3 19 7 15"></polyline>
                    <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                  </svg>

                  <span>{{ isPadLooping(selectedPad()!) ? 'Loop' : '1-Shot' }}</span>
                </button>
              </div>
            </div>

            <div class="param-box waveform-box">
              <div class="row-header">
                <label>Sample Navigation</label>
                <div class="coord-display" *ngIf="hasSound(selectedPad()!) || loadedPads().has(selectedPad()!)">
                  <span>{{ currentTrimIn().toFixed(3) }}s</span>
                  <span class="divider">|</span>
                  <span>{{ currentTrimOut().toFixed(3) }}s</span>
                </div>
              </div>

              <div class="navigation-rail" [class.locked-mode]="playingPads().has(selectedPad()!)">
                <ng-container *ngIf="hasSound(selectedPad()!) || loadedPads().has(selectedPad()!); else noSignal">

                  <div class="marker-lane top in-marker" [class.disabled]="playingPads().has(selectedPad()!)">
                    <div class="marker-visual" [style.left.%]="inMarkerPos()">
                      <span class="marker-label">in</span>
                      <div class="triangle-down"></div>
                    </div>
                    <input type="range" min="0" [max]="maxDuration()" step="0.001" [ngModel]="currentTrimIn()"
                      [disabled]="playingPads().has(selectedPad()!)" (input)="updateTrim($event, 'in')"
                      (wheel)="handleWheel($event, 'trimIn')" title="Adjust sample start point">
                  </div>

                  <div class="canvas-container">
                    <canvas #waveformCanvas id="waveformCanvas"></canvas>
                    <div class="lock-overlay" *ngIf="playingPads().has(selectedPad()!)">
                      <svg viewBox="0 0 24 24" width="16" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                      </svg>
                      <span>SIGNAL LOCKED FOR PLAYBACK</span>
                    </div>
                  </div>

                  <div class="marker-lane bottom out-marker" [class.disabled]="playingPads().has(selectedPad()!)">
                    <div class="marker-visual" [style.left.%]="outMarkerPos()">
                      <div class="triangle-up"></div>
                      <span class="marker-label">out</span>
                    </div>
                    <input type="range" min="0" [max]="maxDuration()" step="0.001" [ngModel]="currentTrimOut()"
                      [disabled]="playingPads().has(selectedPad()!)" (input)="updateTrim($event, 'out')"
                      (wheel)="handleWheel($event, 'trimOut')" title="Adjust sample end point">
                  </div>

                </ng-container>

                <ng-template #noSignal>
                  <div class="no-signal-placeholder">
                    <span>WAITING FOR AUDIO SIGNAL...</span>
                  </div>
                </ng-template>
              </div>
            </div>

          </div>
        </div>
      </ng-container>

      <ng-template #emptyPanel>
        <div class="empty-message">
          <p>SELECT A PAD TO BEGIN CALIBRATION</p>
          <div class="decorative-line"></div>
        </div>
      </ng-template>
    </section>
  </main>
</div>

<div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeModal()" title="Dismiss window">✕</button>

    <div *ngIf="['factory-reset', 'clear-all', 'clear-selected'].includes(modalMode()!)" class="modal-view manual">

      <ng-container *ngIf="!showFinalResetConfirmation()">
        <div class="manual-header">
          <h2 style="color: #ff4d4d;">{{ modalMode() === 'clear-selected' ? 'RELEASE PAD' : 'SYSTEM PURGE' }}</h2>
          <p class="unit-subtitle">LAYER 01 // {{ modalMode()?.replace('-', ' ') | uppercase }}</p>
        </div>

        <hr class="divider">

        <div class="m-text-block">
          <p *ngIf="modalMode() === 'clear-selected' && !selectedPad()">
            <span style="opacity: 0.6;">SIGNAL ERROR:</span> PLEASE SELECT A PAD FIRST.
          </p>

          <p
            *ngIf="modalMode() === 'clear-selected' && selectedPad() && !(hasSound(selectedPad()!) || loadedPads().has(selectedPad()!))">
            <span style="opacity: 0.6;">SIGNAL ERROR:</span> NO SAMPLE LOADED ON PAD [ {{selectedPad()}} ].
          </p>

          <p
            *ngIf="modalMode() === 'clear-selected' && selectedPad() && (hasSound(selectedPad()!) || loadedPads().has(selectedPad()!))">
            Release frequency calibration for Pad [ {{selectedPad()}} ]?
          </p>

          <p *ngIf="modalMode() === 'clear-all'">
            Purge all pad assignments? (Settings & Theme will be preserved)
          </p>

          <p *ngIf="modalMode() === 'factory-reset'">
            Total System Wipe? (All data and themes will be lost)
          </p>
        </div>

        <div class="matrix-options">
          <button (click)="closeModal()" title="Cancel operation">ABORT</button>

          <button
            *ngIf="modalMode() !== 'clear-selected' || (selectedPad() && (hasSound(selectedPad()!) || loadedPads().has(selectedPad()!)))"
            (click)="triggerSecondSecurityLayer()" style="border-color: #ff4d4d; color: #ff4d4d;"
            title="Proceed to final security layer">
            CONTINUE
          </button>
        </div>
      </ng-container>

      <ng-container *ngIf="showFinalResetConfirmation()">
        <div class="manual-header">
          <h2 style="color: #ff4d4d; text-shadow: 0 0 10px #ff4d4d;">FINAL CLEARANCE</h2>
          <p class="unit-subtitle">LAYER 02 // IRREVERSIBLE</p>
        </div>

        <hr class="divider">

        <div class="m-text-block">
          <p><strong>CONFIRM EXECUTION?</strong></p>
        </div>

        <div class="matrix-options" style="justify-content: center; gap: 20px;">
          <button (click)="showFinalResetConfirmation.set(false)" title="Return to first layer">GO BACK</button>

          <button *ngIf="modalMode() === 'clear-selected'" (click)="executeClearSelected()"
            style="background: #ff4d4d; color: #111; font-weight: bold; border: none; padding: 0px 20px; cursor: pointer;"
            title="Execute Pad Clearance">
            CLEAR PAD
          </button>

          <button *ngIf="modalMode() === 'clear-all'" (click)="executeClearAllPads()"
            style="background: #ff4d4d; color: #111; font-weight: bold; border: none; padding: 0px 20px; cursor: pointer;"
            title="Execute All Signal Purge">
            CLEAR ALL
          </button>

          <button *ngIf="modalMode() === 'factory-reset'" (click)="confirmFactoryReset()"
            style="background: #ff4d4d; color: #111; font-weight: bold; border: none; padding: 0px 20px; cursor: pointer;"
            title="Execute Total System Wipe">
            TOTAL RESET
          </button>
        </div>
      </ng-container>

      <div class="manual-footer" style="margin-top: 40px;">
        <p style="color: #666;
        line-height: 1.6;
        font-size: 0.75rem;">SIGNAL PATH STATUS: RESTRICTED</p>
      </div>
    </div>

    <div *ngIf="modalMode() === 'info'" class="modal-view info-layout">
      <div class="manual-header">
        <h2>L-SAMP <span class="accent">100</span></h2>
        <p class="unit-subtitle">BROADCAST SAMPLING UNIT // VER 1.0.0</p>
      </div>

      <hr class="divider">

      <div class="text-block">
        <div class="studio-credits">
          <div class="credit-row">
            <span class="role">ENGINEERING & LOGIC</span>
            <span class="entity">CHRIS KARAYANNIDIS</span>
          </div>
          <div class="credit-row">
            <span class="role">PRODUCED BY</span>
            <span class="entity">LITURGY // PROGRESSIVE PERCEPTIONS</span>
          </div>
          <div class="credit-row">
            <span class="role">TECHNICAL COLLABORATION</span>
            <span class="entity">GEMINI 3.0</span>
          </div>
        </div>

        <div class="purpose-section">
          <h3>SYSTEM FUNCTION</h3>
          <p>
            The L-SAMP 100 is a <strong>High-Fidelity Broadcast Sampler</strong> designed for real-time
            audio manipulation in professional settings. It allows operators to trigger, loop, and
            dynamically alter audio signals through precise <strong>Attack/Release</strong> envelopes and
            <strong>Non-Destructive</strong> waveform trimming.
          </p>
        </div>

        <blockquote>
          <div class="logo-wrap">
            <img
              src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iODcuNTAxMDM4IgogICBoZWlnaHQ9IjQwIgogICB2aWV3Qm94PSIwIDAgMjMuMTUxMzA4IDEwLjU4MzMzMyIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIgogICBzb2RpcG9kaTpkb2NuYW1lPSJsaXRsb2dvLnN2ZyIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAKPC9zdmc+Cg=="
              alt="Liturgy Logo" class="studio-logo">
          </div>
        </blockquote>
      </div>

      <div class="manual-footer">
        <p>© 2026 | ALL SIGNAL PATHS NOMINAL</p>
      </div>
    </div>

    <div *ngIf="modalMode() === 'instructions'" class="modal-view manual">
      <div class="manual-header">
        <h2 class="accent">OPERATING INSTRUCTIONS</h2>
        <p class="unit-subtitle">L-SAMP 100 // SYSTEM GUIDE</p>
      </div>

      <hr class="divider">

      <div class="manual-grid">
        <div class="manual-section">
          <h3><span class="step-num">01</span> TRIGGER INTERFACE</h3>
          <p> Engage pads using <strong>QWER / ASDF / ZXCV</strong>. The active pad is highlighted with the system
            accent color. Use <strong>[SPACE]</strong> for an immediate global stop.</p>
        </div>

        <div class="manual-section">
          <h3><span class="step-num">02</span> LOADING SOUNDS</h3>
          <p>Select a pad and use the <strong>Harbor</strong> menu to choose a file. Click the <strong>Refresh</strong>
            icon to sync with your local folder, or use the <strong>Injected</strong> link to upload from a custom path.
          </p>
        </div>

        <div class="manual-section">
          <h3><span class="step-num">03</span> CALIBRATION</h3>
          <p>Adjust <strong>Gain</strong> (Volume) and <strong>Envelope</strong> (Attack/Release) per pad. Use the
            waveform markers to trim the start and end points. All settings are automatically cached.</p>
        </div>
      </div>

      <div class="manual-footer">
        <p style="color: #666;
        line-height: 1.6;
        font-size: 0.75rem;">VERSION 1.0.0 | ALL SIGNAL PATHS NOMINAL</p>
      </div>
    </div>

    <div *ngIf="modalMode() === 'settings'" class="modal-view settings-layout">
      <div class="manual-header">
        <h2 class="accent">SYSTEM CALIBRATION</h2>
        <p class="unit-subtitle">GLOBAL PREFERENCES & SURFACE MAPPING</p>
      </div>

      <hr class="divider">

      <div class="setting-group">
        <div class="group-header">
          <label>SURFACE CONFIGURATION</label>
          <span class="meta-tag">MATRIX SELECTION</span>
        </div>
        <div class="matrix-options">
          <button [class.active]="matrix() === '1x4'" (click)="updateMatrix('1x4')"
            title="Switch to 1x4 layout">1X4</button>
          <button [class.active]="matrix() === '2x4'" (click)="updateMatrix('2x4')"
            title="Switch to 2x4 layout">2X4</button>
          <button [class.active]="matrix() === '3x4'" (click)="updateMatrix('3x4')"
            title="Switch to 3x4 layout">3X4</button>
        </div>
      </div>

      <div class="setting-group">
        <div class="group-header">
          <label>MASTER GAIN ATTENUATION</label>
          <span class="value-readout">{{ (masterVolume() * 100).toFixed(0) }}%</span>
        </div>
        <input type="range" class="vol-slider" min="0" max="1.5" step="0.01" [value]="masterVolume()"
          (input)="updateGlobalGain($any($event.target).value)" title="Adjust master output gain">
      </div>

      <div class="setting-group">
        <div class="group-header">
          <label>THEME IDENTITY</label>
          <span class="meta-tag">CHROMATIC PRESET</span>
        </div>
        <div class="theme-swatches">
          <div class="swatch teal" [class.active]="accentColor() === '#00ffcc'" (click)="setTheme('#00ffcc')"
            title="Activate Teal Theme"></div>
          <div class="swatch amber" [class.active]="accentColor() === '#ffbf00'" (click)="setTheme('#ffbf00')"
            title="Activate Amber Theme"></div>
          <div class="swatch marooned" [class.active]="accentColor() === '#ff4d4d'" (click)="setTheme('#ff4d4d')"
            title="Activate Maroon Theme"></div>
        </div>
      </div>

      <div class="manual-footer">
        <p style="color: #666;
        line-height: 1.6;
        font-size: 0.75rem;">EEPROM STATE: SYNCED</p>
      </div>
    </div>
  </div>
</div>